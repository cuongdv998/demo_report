<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Google Sheets Editor Demo</title>
  <script src="https://apis.google.com/js/api.js"></script>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; }
    button { padding: 10px 18px; border-radius: 6px; cursor: pointer; }
    #content { margin-top: 20px; padding: 10px; border: 1px solid #ddd; border-radius: 8px; }
  </style>
</head>
<body>
  <h2>ğŸ“ Demo chá»‰nh sá»­a Google Sheet báº±ng JavaScript</h2>
  <p>Nháº¥n <b>ÄÄƒng nháº­p Google</b> Ä‘á»ƒ cáº¥p quyá»n, sau Ä‘Ã³ nháº­p giÃ¡ trá»‹ ghi vÃ o Google Sheet.</p>

  <button id="authorize_button">ğŸ”‘ ÄÄƒng nháº­p Google</button>
  <button id="signout_button" style="display:none;">ğŸšª ÄÄƒng xuáº¥t</button>

  <div id="content"></div>

  <script>
    // ğŸ‘‰ Thay cÃ¡c giÃ¡ trá»‹ sau báº±ng cá»§a báº¡n
    const CLIENT_ID = "PASTE_CLIENT_ID_HERE.apps.googleusercontent.com";
    const API_KEY = "PASTE_API_KEY_HERE";
    const SCOPES = "https://www.googleapis.com/auth/spreadsheets";
    const SPREADSHEET_ID = "PASTE_SHEET_ID_HERE"; // láº¥y tá»« URL sheet
    const RANGE = "Sheet1!A1";

    const authorizeButton = document.getElementById("authorize_button");
    const signoutButton = document.getElementById("signout_button");
    const content = document.getElementById("content");

    // 1ï¸âƒ£ Load thÆ° viá»‡n gapi
    function handleClientLoad() {
      gapi.load("client:auth2", initClient);
    }

    // 2ï¸âƒ£ Khá»Ÿi táº¡o Google API Client
    async function initClient() {
      await gapi.client.init({
        apiKey: API_KEY,
        clientId: CLIENT_ID,
        discoveryDocs: ["https://sheets.googleapis.com/$discovery/rest?version=v4"],
        scope: SCOPES
      });

      const auth = gapi.auth2.getAuthInstance();
      auth.isSignedIn.listen(updateSigninStatus);
      updateSigninStatus(auth.isSignedIn.get());

      authorizeButton.onclick = () => auth.signIn();
      signoutButton.onclick = () => auth.signOut();
    }

    // 3ï¸âƒ£ Khi tráº¡ng thÃ¡i Ä‘Äƒng nháº­p thay Ä‘á»•i
    function updateSigninStatus(isSignedIn) {
      if (isSignedIn) {
        authorizeButton.style.display = "none";
        signoutButton.style.display = "inline-block";
        writeSheet();
      } else {
        authorizeButton.style.display = "inline-block";
        signoutButton.style.display = "none";
      }
    }

    // 4ï¸âƒ£ Ghi dá»¯ liá»‡u vÃ o Google Sheet
    async function writeSheet() {
      const value = prompt("Nháº­p ná»™i dung báº¡n muá»‘n ghi vÃ o Ã´ A1:", "Hello Google Sheets!");
      if (!value) return;

      try {
        const response = await gapi.client.sheets.spreadsheets.values.update({
          spreadsheetId: SPREADSHEET_ID,
          range: RANGE,
          valueInputOption: "RAW",
          resource: { values: [[value]] }
        });

        content.innerHTML = `
          âœ… <b>ÄÃ£ ghi thÃ nh cÃ´ng!</b><br>
          <b>Sheet ID:</b> ${SPREADSHEET_ID}<br>
          <b>Ã”:</b> ${RANGE}<br>
          <b>GiÃ¡ trá»‹:</b> ${value}
        `;
      } catch (err) {
        content.innerHTML = `<span style="color:red">âŒ Lá»—i: ${err.message}</span>`;
      }
    }

    // Gá»i khi trang load
    window.onload = handleClientLoad;
  </script>
</body>
</html>
